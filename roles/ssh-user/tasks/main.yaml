- name: "Create user {{ user }}"
  ansible.builtin.user:
    name: "{{ user }}"
    shell: "{{ shell | default('/bin/sh') }}"
    group: "{{ user_group | default('') }}"
    groups: "{{ user_groups | default([]) }}"
    password: "*"
    update_password: on_create
    append: yes
    system: "{{ system | default(false) }}"
  tags: [ ssh ]

- name: "Download authorized_keys from GitHub for user {{ user }}"
  ansible.posix.authorized_key:
    user: "{{ user }}"
    key: "https://github.com/{{ item }}.keys"
  loop: "{{ github_usernames }}"
  tags: [ ssh ]

